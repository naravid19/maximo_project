<!-- templates\upload.html -->

{% extends 'maximo_app/base.html' %}

{% load static %}
{% load widget_tweaks %}

{% block title %}Upload Files{% endblock %}
{% block style %}
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    {% if messages %}
        {% for message in messages %}
        
            <div class="flex justify-center w-full">
                <div id="alert-{{ forloop.counter }}" class="flex items-center w-full max-w-screen-sm p-4 mt-2 mb-4 text-white bg-red-600 rounded-lg shadow-md dark:bg-red-700 dark:text-white" role="alert">
                    <svg class="flex-shrink-0 w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                    </svg>
                    <span class="sr-only">Info</span>
                    <div class="text-base font-medium">
                        {{ message|safe }}
                    </div>
                    <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-transparent text-white rounded-lg focus:ring-2 focus:ring-red-300 p-1.5 hover:bg-red-500 hover:text-white inline-flex items-center justify-center h-8 w-8 dark:hover:bg-red-600" onclick="this.parentElement.remove();" aria-label="Close">
                        <span class="sr-only">Close</span>
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                        </svg>
                    </button>
                </div>
            </div>
        
        {% endfor %}
    {% endif %}
    
    {% if error_messages %}
    <div class="flex p-4 mb-4 text-sm text-red-800 border border-red-300 rounded-lg shadow-md sm:text-xs md:text-sm lg:text-base xl:text-lg 2xl:text-xl bg-red-50 dark:bg-gray-800 dark:text-red-400 dark:border-red-600" role="alert">
        <svg class="flex-shrink-0 inline w-4 h-4 sm:w-4 sm:h-4 md:w-5 md:h-5 lg:w-6 lg:h-6 me-3 mt-[2px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
        </svg>
        <span class="sr-only">Danger</span>
        <div class="flex-1">
            <span class="text-base font-semibold sm:text-base md:text-lg lg:text-lg xl:text-lg 2xl:text-xl">ข้อมูลไม่สมบูรณ์:</span>
            <ul class="mt-2 ml-4 space-y-1 text-sm list-disc list-inside sm:text-sm md:text-base lg:text-base xl:text-base 2xl:text-lg">
                {% for message in error_messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    {% if not schedule_filename and not location_filename and not 'download_link_comment' in request.session %}
        <div class="max-w-screen-sm p-6 mx-auto mb-8 text-center rounded-lg shadow-lg bg-blue-50">
            <h1 class="text-xl font-extrabold leading-tight text-gray-900 sm:text-2xl md:text-3xl lg:text-4xl sm:leading-tight md:leading-tight lg:leading-tight">
                โปรแกรมตรวจสอบและจัดทำข้อมูลงานบำรุงรักษาแบบหยุดตามวาระ (Planned Outage) สำหรับระบบ MMS (Maximo)<br>
            </h1>
            <div class="w-16 h-1 mx-auto mt-6 rounded sm:w-20 bg-gradient-to-r from-blue-500 to-blue-700"></div>
            {% comment %} <p class="mt-4 text-base text-gray-700 sm:mt-6 sm:text-lg"></p> {% endcomment %}
        </div>
    {% endif %}

    <ol class="relative flex items-center justify-center max-w-screen-sm px-6 py-4 mx-auto my-4 space-x-4 text-sm font-medium text-center text-gray-500 bg-white border border-gray-200 rounded-lg shadow-sm dark:text-gray-400 sm:text-base dark:bg-gray-800 dark:border-gray-700 rtl:space-x-reverse">
        <li class="flex items-center {% if not schedule_filename and not location_filename and not 'download_link_comment' in request.session or error_messages and schedule_filename and location_filename and 'download_link_comment' in request.session or not error_messages and not 'download_link_job_plan_task' in request.session and not 'download_link_job_plan_labor' in request.session and not 'download_link_pm_plan' in request.session and not 'download_link_template' in request.session and schedule_filename and location_filename and 'download_link_comment' in request.session or 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}text-blue-600 dark:text-blue-500{% endif %}">
            <span class="flex items-center justify-center w-5 h-5 text-xs border {% if not schedule_filename and not location_filename and not 'download_link_comment' in request.session or error_messages and schedule_filename and location_filename and 'download_link_comment' in request.session or not error_messages and not 'download_link_job_plan_task' in request.session and not 'download_link_job_plan_labor' in request.session and not 'download_link_pm_plan' in request.session and not 'download_link_template' in request.session and schedule_filename and location_filename and 'download_link_comment' in request.session or 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}border-blue-600{% else %}border-gray-500 dark:border-gray-400{% endif %} rounded-full me-2 shrink-0">
                1
            </span>
            <span data-tooltip-target="step-1" class="ms-2 cursor-help">กรอกข้อมูล<span class="hidden sm:inline">และอัปโหลด</span></span>
            <svg class="w-3 h-3 ms-2 sm:ms-4 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m7 9 4-4-4-4M1 9l4-4-4-4"/>
            </svg>
        </li>
        <li class="flex items-center {% if error_messages and schedule_filename and location_filename and 'download_link_comment' in request.session or not error_messages and not 'download_link_job_plan_task' in request.session and not 'download_link_job_plan_labor' in request.session and not 'download_link_pm_plan' in request.session and not 'download_link_template' in request.session and schedule_filename and location_filename and 'download_link_comment' in request.session or 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}text-blue-600 dark:text-blue-500{% endif %}">
            <span class="flex items-center justify-center w-5 h-5 text-xs border {% if error_messages and schedule_filename and location_filename and 'download_link_comment' in request.session or not error_messages and not 'download_link_job_plan_task' in request.session and not 'download_link_job_plan_labor' in request.session and not 'download_link_pm_plan' in request.session and not 'download_link_template' in request.session and schedule_filename and location_filename and 'download_link_comment' in request.session or 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}border-blue-600 dark:border-blue-500{% else %}border-gray-500 dark:border-gray-400{% endif %} rounded-full me-2 shrink-0">
                2
            </span>
            <span data-tooltip-target="step-2" class="ms-2 cursor-help">ตรวจสอบ<span class="hidden sm:inline">และแก้ไข</span></span>
            <svg class="w-3 h-3 ms-2 sm:ms-4 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m7 9 4-4-4-4M1 9l4-4-4-4"/>
            </svg>
        </li>
        <li class="flex items-center {% if 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}text-blue-600 dark:text-blue-500{% endif %}">
            <span class="flex items-center justify-center w-5 h-5 text-xs border {% if 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}border-blue-600 dark:border-blue-500{% else %}border-gray-500 dark:border-gray-400{% endif %} rounded-full me-2 shrink-0">
                3
            </span>
            <span data-tooltip-target="step-3" class="cursor-help">ดาวน์โหลด<span class="hidden sm:inline">ไฟล์</span></span>
        </li>
    </ol>

    <div id="step-1" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
        กรอกข้อมูลลงแบบฟอร์ม และอัปโหลดไฟล์ Final Schedule, Location File
        <div class="tooltip-arrow" data-popper-arrow></div>
    </div>
    <div id="step-2" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
        หากข้อมูลไม่ถูกต้องหรือไม่ครบถ้วน ระบบจะไม่อนุญาตให้ดำเนินการต่อ
        <div class="tooltip-arrow" data-popper-arrow></div>
    </div>
    <div id="step-3" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
        ดาวน์โหลดไฟล์ Job Plan Labor, Job Plan Task, PM Plan, Template MxLoader JB-PM Plan
        <div class="tooltip-arrow" data-popper-arrow></div>
    </div>
    
    {% if not schedule_filename and not location_filename and not 'download_link_comment' in request.session %}
        <div class="container relative px-6 pt-[1.375rem] pb-4 max-w-screen-sm mx-auto my-4 bg-white rounded-md shadow-sm">
            <p class="mb-4 text-base font-medium text-gray-600">FOR IBM MAXIMO</p>
        
            <!-- Content box -->
            <div class="flex flex-col gap-4 px-6 pt-3 pb-4 mt-4 bg-white border border-gray-200 rounded-lg">
            {% comment %} <div class="flex flex-col gap-3 px-6 pt-2 pb-3 mt-3 border-t border-gray-200"> {% endcomment %}
                <!-- Template PO-Schedule Section -->
                <div class="flex items-center justify-between pb-2 border-b border-dashed">
                    <p class="text-base font-normal text-gray-700">
                        📚 คู่มือการใช้งานระบบ
                    </p>
                    <a href="#" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v12m0 0l-3-3m3 3l3-3"/><path d="M5 20h14"/></svg>
                        DOWNLOAD
                    </a>
                </div>
                
                <div class="flex items-center justify-between pb-2 border-b border-dashed">
                    <p class="text-base font-normal text-gray-700">
                        📄 FINAL SCHEDULE(BLANK)
                    </p>
                    <a href="{% url 'download_schedule' %}" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v12m0 0l-3-3m3 3l3-3"/><path d="M5 20h14"/></svg>
                        DOWNLOAD
                    </a>
                </div>
                
                <div class="flex items-center justify-between pb-2 border-b border-dashed">
                    <p class="text-base font-normal text-gray-700">
                        📄 TEMPLATE MXLOADER JB-PM PLAN(BLANK)
                    </p>
                    <a href="{% url 'download_original_template' %}" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v12m0 0l-3-3m3 3l3-3"/><path d="M5 20h14"/></svg>
                        DOWNLOAD
                    </a>
                </div>

                <div class="flex items-center justify-between pb-2 border-b border-dashed">
                    <p class="text-base font-normal text-gray-700">
                        📊 FINAL SCHEDULE(EXAMPLE)
                    </p>
                    <a href="{% url 'download_example_schedule' %}" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v12m0 0l-3-3m3 3l3-3"/><path d="M5 20h14"/></svg>
                        DOWNLOAD
                    </a>
                </div>

                <div class="flex items-center justify-between">
                    <p class="text-base font-normal text-gray-700">
                        📊 TEMPLATE MXLOADER JB-PM PLAN(EXAMPLE)
                    </p>
                    <a href="{% url 'download_example_template' %}" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v12m0 0l-3-3m3 3l3-3"/><path d="M5 20h14"/></svg>
                        DOWNLOAD
                    </a>
                </div>
            </div>

            <!-- Required question notice -->
            <p class="px-6 mt-3 text-sm font-normal text-red-600">
                * กรุณาระบุข้อมูลให้ครบถ้วน
            </p>
        </div>
        

        <div class="container relative px-6 pt-[1.375rem] pb-4 max-w-screen-sm mx-auto my-4 bg-white rounded-md shadow-sm">
            <h1 class="mb-4 text-2xl font-medium text-gray-800">
                กรอกข้อมูลและอัพโหลดไฟล์
            </h1>
            <form id="uploadForm" novalidate method="post" enctype="multipart/form-data" class="space-y-6" onsubmit="validateUploadForm(event)">
                {% csrf_token %}

                <!-- Dropdown สำหรับเลือกปี -->
                <div class="sm:col-span-3">
                    <label for="year" class="flex items-center gap-2 text-base font-medium leading-6 text-gray-900">
                        {% comment %} <img src="{% static 'icon/year.svg' %}" alt="Year icon" class="w-5 h-5"> {% endcomment %}
                        {{ form.year.label }}
                        {% if form.year.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.year|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.year.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.year.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Dropdown สำหรับเลือกความถี่ -->
                <div class="sm:col-span-3">
                    <label for="frequency" class="flex items-center gap-2 text-base font-medium leading-6 text-gray-900">
                        {% comment %} <img src="{% static 'icon/frequency.svg' %}" alt="Frequency icon" class="w-5 h-5"> {% endcomment %}
                        {{ form.frequency.label }} (Years)
                        {% if form.frequency.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.frequency|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.frequency.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.frequency.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Dropdown สำหรับเลือก Plant Type -->
                <div class="sm:col-span-3">
                    <label for="plant_type" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.plant_type.label }}
                        {% if form.plant_type.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.plant_type|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.plant_type.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.plant_type.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="plant_type_description" class="mt-1 text-sm text-gray-500"></p>
                </div>

                <!-- Dropdown สำหรับเลือก Site -->
                <div class="sm:col-span-3">
                    <label for="site" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.site.label }}
                        {% if form.site.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.site|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.site.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.site.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="site_description" class="mt-1 text-sm text-gray-500"></p>
                </div>

                <!-- Dropdown สำหรับเลือก Child Site -->
                <div class="sm:col-span-3">
                    <label for="child_site" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.child_site.label }}
                        {% if form.child_site.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.child_site|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.child_site.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.child_site.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="child_site_description" class="mt-1 text-sm text-gray-500"></p>
                </div>

                <!-- Dropdown สำหรับเลือก Unit -->
                <div class="sm:col-span-3">
                    <label for="unit" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.unit.label }}
                        {% if form.unit.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.unit|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.unit.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.unit.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Dropdown สำหรับเลือก WO Status -->
                <div class="sm:col-span-3">
                    <label for="wostatus" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.wostatus.label }}
                        {% if form.wostatus.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.wostatus|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.wostatus.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.wostatus.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="wostatus_description" class="mt-1 text-sm text-gray-500"></p>
                </div>

                <!-- Dropdown สำหรับเลือก Work Type -->
                <div class="sm:col-span-3">
                    <label for="work_type" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.work_type.label }}
                        {% if form.work_type.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.work_type|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.work_type.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.work_type.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="work_type_description" class="mt-1 text-sm text-gray-500"></p>
                </div>
                
                <!-- Dropdown สำหรับเลือก MNTACT TYPE -->
                <div class="sm:col-span-3">
                    <label for="{{ form.acttype.id_for_label }}" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.acttype.label }}
                        {% if form.acttype.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.acttype|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.acttype.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.acttype.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="acttype_description" class="mt-1 text-sm text-gray-500"></p>
                </div>

                <!-- Dropdown สำหรับเลือก WBS -->
                <div class="sm:col-span-3">
                    <label for="wbs" class="block text-base font-medium leading-6 text-gray-900">
                        {{ form.wbs.label }}
                        {% if form.wbs.field.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                    <div class="mt-2">
                        {{ form.wbs|add_class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" }}
                    </div>
                    {% if form.wbs.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.wbs.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <p id="wbs_description" class="mt-1 text-sm text-gray-500"></p>
                </div>
                
                <!-- ฟิลด์สำหรับ Project ID Other -->
                <div class="hidden sm:col-span-3" id="other_projectid_outer_container">
                    <div class="flex items-center space-x-4 ">
                        <label for="projectid_other" class="block text-base font-medium leading-6 text-gray-900">
                            {{ form.projectid_other.label }}:
                            {% if form.projectid_other.field.required %}
                                <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                            {% endif %}
                        </label>
                        <div class="relative flex items-center flex-1" id="other_projectid_inner_container">
                            <span id="other_projectid_signal" class="absolute hidden w-3 h-3 bg-green-500 rounded-full shadow-md top-3 right-3"></span>
                            <input type="text" id="other_projectid" name="projectid_other" class="block rounded-t-lg px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 dark:border-gray-600 appearance-none dark:text-white dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder="" disabled />
                            <label id="label_other_projectid" for="other_projectid" class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4">กรุณากรอกชื่อ PROJECTID ที่สร้างไว้บนระบบ MMS เช่น O-CHNC21-67CI</label>
                            
                            {% if form.projectid_other.errors %}
                            <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                                <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                                </svg>
                                <span class="sr-only">Error</span>
                                <div>
                                    <span class="font-medium">Error:</span>
                                    {% for error in form.projectid_other.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- ฟิลด์สำหรับ WBS Other -->
                <div class="hidden sm:col-span-3" id="other_wbs_outer_container">
                    <div class="flex items-center space-x-4 ">
                        <label for="wbs_other" class="block text-base font-medium leading-6 text-gray-900">
                            {{ form.wbs_other.label }}:
                            {% if form.wbs_other.field.required %}
                                <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                            {% endif %}
                        </label>
                        <div class="relative flex items-center flex-1" id="other_wbs_inner_container">
                            <!-- สัญญาณที่มุมขวาบนของ input -->
                            <span id="other_wbs_signal" class="absolute hidden w-3 h-3 bg-green-500 rounded-full shadow-md top-3 right-3"></span>
                            <input type="text" id="other_wbs" name="wbs_other" class="block rounded-t-lg px-2.5 pb-2.5 pt-5 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 dark:border-gray-600 appearance-none dark:text-white dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder="" disabled />
                            <label id="label_other_wbs" for="other_wbs" class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4">กรุณากรอกชื่อ SUBWBS ที่สร้างไว้บนระบบ MMS เช่น O-CHNC21-67CI-LTSA</label>
                            
                            {% if form.wbs_other.errors %}
                            <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                                <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                                </svg>
                                <span class="sr-only">Error</span>
                                <div>
                                    <span class="font-medium">Error:</span>
                                    {% for error in form.wbs_other.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Checkbox สำหรับ Grouping -->
                <div class="sm:col-span-3">
                    <label for="grouping_options" class="block text-base font-medium leading-6 text-gray-900">
                        Grouping
                        {% if form.fields.selected_order.required %}
                            <span class="text-base font-normal text-red-600" style="position: relative; top: 1px;">*</span>
                        {% endif %}
                    </label>
                
                    <!-- No arrange group Checkbox -->
                    <div class="flex items-center mt-2">
                        <input id="no-arrange-checkbox" name="grouping_options" type="checkbox" value="no_arrange" onclick="handleCheckboxSelection(this)"
                            class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                        <label for="no-arrange-checkbox" class="text-sm font-medium text-gray-900 ms-2 dark:text-gray-300">No arrange group</label>
                    </div>
                
                    <!-- Arrange group Checkbox -->
                    <div class="flex items-center mt-2">
                        <input id="arrange-group-checkbox" type="checkbox" onclick="toggleArrangeOptions(this)"
                            class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                        <label for="arrange-group-checkbox" class="text-sm font-medium text-gray-900 ms-2 dark:text-gray-300">Arrange group</label>
                    </div>
                    <p id="helper-checkbox-text" class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-300">
                        กรุณาเลือกเงื่อนไขการจัดกลุ่ม Work Order อย่างน้อยหนึ่งตัวเลือก
                    </p>
                
                    <!-- Arrange group child checkboxes (ซ่อนเริ่มต้น) -->
                    <div id="arrange-options" class="hidden mt-2 ml-6">
                        <div class="flex items-center me-4">
                            <input id="system-checkbox" name="grouping_options" type="checkbox" value="SYSTEM" onclick="handleCheckboxSelection(this)"
                                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="system-checkbox" class="text-sm font-medium text-gray-900 ms-2 dark:text-gray-300">System</label>
                        </div>
                        <div class="flex items-center me-4">
                            <input id="craft-checkbox" name="grouping_options" type="checkbox" value="EGCRAFT" onclick="handleCheckboxSelection(this)"
                                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="craft-checkbox" class="text-sm font-medium text-gray-900 ms-2 dark:text-gray-300">Craft</label>
                        </div>
                        <div class="flex items-center me-4">
                            <input id="permit-checkbox" name="grouping_options" type="checkbox" value="PTW" onclick="handleCheckboxSelection(this)"
                                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="permit-checkbox" class="text-sm font-medium text-gray-900 ms-2 dark:text-gray-300">Permit Type</label>
                        </div>
                        <div class="flex items-center me-4">
                            <input id="start-date-checkbox" name="grouping_options" type="checkbox" value="NEXTDATE" onclick="handleCheckboxSelection(this)"
                                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="start-date-checkbox" class="text-sm font-medium text-gray-900 ms-2 dark:text-gray-300">Start Date</label>
                        </div>
                    </div>
                
                    <!-- Hidden input สำหรับเก็บลำดับการเลือก -->
                    <input type="hidden" name="selected_order" id="selected_order_input" value="{{ selected_order|join:',' }}">
                
                    {% if form.selected_order.errors %}
                    <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            <span class="font-medium">Error:</span> 
                            {% for error in form.selected_order.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- ฟิลด์สำหรับอัปโหลดไฟล์ Schedule -->
                <div class="sm:col-span-3">
                    <label for="schedule_file" class="block mb-2 text-sm font-medium text-gray-900">{{ form.schedule_file.label_tag }}</label>
                    <div class="mt-2">
                        {{ form.schedule_file|add_class:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" }}
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Allowed formats: XLSM, XLSX.</p>

                    {% if form.schedule_file.errors %}
                        <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                            <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                            </svg>
                            <span class="sr-only">Info</span>
                            <div>
                                <span class="font-medium">Error:</span> 
                                {% for error in form.schedule_file.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                    </div>
                    {% endif %}
                </div>

                <!-- ฟิลด์สำหรับอัปโหลดไฟล์ Location -->
                <div class="sm:col-span-3">
                    <label for="location_file" class="block mb-2 text-sm font-medium text-gray-900">{{ form.location_file.label_tag }}</label>
                    <div class="mt-2">
                        {{ form.location_file|add_class:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" }}
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Allowed formats: XLSM, XLSX.</p>
                    
                    {% if form.location_file.errors %}
                        <div class="flex items-center p-4 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                            <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                            </svg>
                            <span class="sr-only">Info</span>
                            <div>
                                <span class="font-medium">Error:</span> 
                                {% for error in form.location_file.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- ปุ่ม Submit -->
                <button id="uploadBtn" type="submit" name="upload_files" class="relative inline-flex items-center justify-center p-0.5 mb-2 me-2 overflow-hidden text-sm font-medium text-gray-900 rounded-lg group bg-gradient-to-br from-cyan-500 to-blue-500 group-hover:from-cyan-500 group-hover:to-blue-500 hover:text-white dark:text-white focus:ring-4 focus:outline-none focus:ring-cyan-200 dark:focus:ring-cyan-800">
                    <span class="relative px-5 py-2.5 transition-all ease-in duration-75 bg-white dark:bg-gray-900 rounded-md group-hover:bg-opacity-0 inline-flex items-center">
                        อัปโหลดไฟล์
                    </span>
                </button>
            </form>
        </div>

        <div id="loadingOverlay" class="loading-overlay loading-hidden">
            <div class="loading-box">
                <div role="status" class="flex justify-center mb-4">
                    <svg aria-hidden="true" role="status" class="w-8 h-8 mb-2 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                        <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="#1C64F2"/>
                    </svg>
                    <span class="sr-only">Loading...</span>
                </div>
                <p class="mt-2 text-lg text-gray-700">กำลังโหลด...</p>
            </div>
        </div>

    {% else %}
    
        <div class="container relative px-6 pt-[1.375rem] pb-4 max-w-screen-sm mx-auto my-4 bg-white rounded-md shadow-sm">
            <h1 class="mb-4 text-3xl font-medium text-left text-gray-800">ตรวจสอบและแก้ไขข้อมูล</h1>
            <div class="flex flex-col gap-4 px-6 pt-3 pb-4 mt-4 bg-white border border-gray-200 rounded-lg">
                {% if 'download_link_comment' in request.session %}
                    <div class="flex items-center justify-between">
                        <p class="text-base font-normal text-gray-700">
                            📝 ไฟล์คอมเมนต์
                        </p>
                        <a href="{% url 'download_comment_file' %}" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v12m0 0l-3-3m3 3l3-3"/><path d="M5 20h14"/></svg>
                            DOWNLOAD
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
    {% endif %}

    {% if 'download_link_comment' in request.session %}
    
    <div class="container relative max-w-screen-sm mx-auto my-4 overflow-x-auto bg-white rounded-lg shadow-sm sm:rounded-xl dark:bg-gray-800">    
        <table class="w-full text-sm text-left text-gray-700 dark:text-gray-300">
            <thead class="bg-gray-100 dark:bg-gray-700">
                <tr>
                    <th class="px-6 py-3 font-semibold text-gray-500 uppercase dark:text-gray-400">Data Preview Before Convert</th>
                    <th class="px-6 py-3 font-semibold text-gray-500 uppercase dark:text-gray-400">Value</th>
                </tr>
            </thead>
            <tbody>
                <!-- EGPROJECTID -->
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        EGPROJECTID
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.egprojectid }}
                    </td>
                </tr>
                <!-- EGWBS (MMA WORK LIST) -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        EGWBS (MMA WORK LIST)
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.egwbs }}
                    </td>
                </tr>
                <!-- FREQUENCY -->
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        FREQUENCY
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.frequency }}
                    </td>
                </tr>
                <!-- YEAR -->
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        YEAR
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.year }}
                    </td>
                </tr>
                <!-- SITEID -->
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        SITEID
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.siteid }}
                    </td>
                </tr>
                <!-- LOCATION(UNIT) -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        LOCATION (UNIT)
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.location }}
                    </td>
                </tr>
                <!-- WOSTATUS -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        WOSTATUS
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.wostatus }}
                    </td>
                </tr>
                <!-- WORKTYPE -->
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        WORKTYPE
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.worktype }}
                    </td>
                </tr>
                <!-- EGMNTACTTYPE -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        EGMNTACTTYPE
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.egmntacttype }}
                    </td>
                </tr>
                <!-- SUBWBS GROUP -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        SUBWBS GROUP
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.wbs }}
                    </td>
                </tr>
                <!-- WBS Description -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        WBS Description
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.wbs_desc }}
                    </td>
                </tr>
                <!-- GROUPING -->
                <tr class="border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 dark:text-white">
                        GROUPING
                    </th>
                    <td class="px-6 py-4">
                        {{ request.session.grouping_text }}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    {% endif %}

    {% if not error_messages %}
        {% if 'download_link_job_plan_task' in request.session or 'download_link_job_plan_labor' in request.session or 'download_link_pm_plan' in request.session or 'download_link_template' in request.session %}
            <div class="container relative max-w-screen-sm mx-auto my-4 bg-[#f0ebf8] rounded-md shadow-sm">
                <details open class="mt-4 bg-white border border-gray-200 rounded">
                    <summary class="flex items-center justify-between p-4 font-bold text-white bg-[rgb(63,81,181)] rounded-t">
                        <span class="text-lg">ดาวน์โหลด Job Plan , PM Plan Template</span>
                    </summary>
                    <div class="p-4 mt-3">
                        <ul class="space-y-4">
                            {% if 'download_link_job_plan_task' in request.session %}
                            <li class="flex items-center justify-between p-3 bg-white border rounded-lg shadow-sm">
                                <div class="flex items-center">
                                    <img src="{% static 'icon/excel.svg' %}" alt="Excel icon" width="20" height="20" class="mr-2">
                                    <a href="{% url 'download_job_plan_task_file' %}" class="font-semibold text-blue-600 truncate hover:underline">
                                        ดาวน์โหลดไฟล์ Job Plan Task
                                    </a>
                                </div>
                            </li>
                            {% endif %}
            
                            {% if 'download_link_job_plan_labor' in request.session %}
                            <li class="flex items-center justify-between p-3 bg-white border rounded-lg shadow-sm">
                                <div class="flex items-center">
                                    <img src="{% static 'icon/excel.svg' %}" alt="Excel icon" width="20" height="20" class="mr-2">
                                    <a href="{% url 'download_job_plan_labor_file' %}" class="font-semibold text-blue-600 truncate hover:underline">
                                        ดาวน์โหลดไฟล์ Job Plan Labor
                                    </a>
                                </div>
                            </li>
                            {% endif %}
            
                            {% if 'download_link_pm_plan' in request.session %}
                            <li class="flex items-center justify-between p-3 bg-white border rounded-lg shadow-sm">
                                <div class="flex items-center">
                                    <img src="{% static 'icon/excel.svg' %}" alt="Excel icon" width="20" height="20" class="mr-2">
                                    <a href="{% url 'download_pm_plan_file' %}" class="font-semibold text-blue-600 truncate hover:underline">
                                        ดาวน์โหลดไฟล์ PM Plan
                                    </a>
                                </div>
                            </li>
                            {% endif %}
            
                            {% if 'download_link_template' in request.session %}
                            <li class="flex items-center justify-between p-3 bg-white border rounded-lg shadow-sm">
                                <div class="flex items-center">
                                    <img src="{% static 'icon/excel.svg' %}" alt="Excel icon" width="20" height="20" class="mr-2">
                                    <a href="{% url 'download_template_file' %}" class="font-semibold text-blue-600 truncate hover:underline">
                                        ดาวน์โหลดไฟล์ Template MxLoader JB-PM Plan
                                    </a>
                                </div>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                </details>
            </div>
            
        {% endif %}
    {% endif %}
    
    <footer class="container relative max-w-screen-sm mx-auto my-4 bg-white rounded-lg shadow-sm dark:bg-gray-800">
        <div class="flex items-center justify-center w-full max-w-screen-xl p-4 mx-auto">
            <span class="text-sm text-center text-gray-500 dark:text-gray-400">
                หากพบปัญหาการใช้งาน กรุณาติดต่อแผนกระบบงานบำรุงรักษา (หรบ-ฟ.)<br>
                กองวิศวกรรมบำรุงรักษา (กวบ-ฟ.)<br>
                ฝ่ายบริหารจัดการสินทรัพย์ผลิตไฟฟ้า (อหฟ.)<br>
                โทร. 67341 , 67348
            </span>
        </div>
    </footer>
{% endblock%}

{% block script %}
    <script>
        const ajaxUrls = {
            plantTypeUrl: "{% url 'filter_plant_type' %}",
            actTypeUrl: "{% url 'filter_acttype' %}",
            siteFilterUrl: "{% url 'filter_site' %}",
            childSiteFilterUrl: "{% url 'filter_child_site' %}",
            wbsFilterUrl: "{% url 'filter_wbs' %}",
            workTypeUrl: "{% url 'filter_worktype' %}",
            wostatusFilterUrl: "{% url 'filter_wostatus' %}"
            
        };
    </script>
    
    <script src="{% static 'js/form-validation.js' %}"></script>
    <script src="{% static 'js/upload-loading.js' %}"></script>
    <script src="{% static 'js/ajax-plant-type.js' %}"></script>
    <script src="{% static 'js/ajax-site.js' %}"></script>
    <script src="{% static 'js/ajax-child-site.js' %}"></script>
    <script src="{% static 'js/ajax-worktype.js' %}"></script>
    <script src="{% static 'js/ajax-acttype.js' %}"></script>
    <script src="{% static 'js/ajax-wbs.js' %}"></script>
    <script src="{% static 'js/ajax-wostatus.js' %}"></script>
    <script src="{% static 'js/grouping.js' %}"></script>
{% endblock %}
